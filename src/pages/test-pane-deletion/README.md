# Pane åˆ é™¤æµ‹è¯•é¡µé¢

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯• lightweight-charts ä¸­ Pane åˆ é™¤åŠŸèƒ½çš„æµ‹è¯•é¡µé¢ã€‚è¯¥é¡µé¢æ¨¡æ‹Ÿäº†çœŸå®çš„å›æµ‹å›¾è¡¨é…ç½®ç»“æ„ï¼Œç”¨äºéªŒè¯ä¸åŒåˆ é™¤æ–¹å¼çš„è¡Œä¸ºå’Œé—®é¢˜ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. çœŸå®é…ç½®ç»“æ„
- ä½¿ç”¨ä¸ç”Ÿäº§ç¯å¢ƒç›¸åŒçš„ `BacktestChartConfig` é…ç½®ç»“æ„
- åŒ…å«ä¸»å›¾æŒ‡æ ‡å’Œå­å›¾æŒ‡æ ‡
- æ”¯æŒä¸åŒç±»å‹çš„ Seriesï¼ˆçº¿å›¾ã€æŸ±çŠ¶å›¾ï¼‰

### 2. ä¸‰ç§åˆ é™¤æ–¹å¼æµ‹è¯•

#### ğŸŸ  åªåˆ é™¤ Paneï¼ˆä¿ç•™é…ç½®ï¼‰
- **é€‚ç”¨èŒƒå›´**: ä»…å­å›¾æŒ‡æ ‡
- **æ“ä½œ**: ç›´æ¥è°ƒç”¨ `chartApi.removePane(paneIndex)`
- **ç»“æœ**: Pane è¢«åˆ é™¤ï¼Œä½† React ç»„ä»¶é…ç½®ä¿ç•™
- **é—®é¢˜**: å¯èƒ½å¯¼è‡´ React ç»„ä»¶ä¸ Chart API çŠ¶æ€ä¸ä¸€è‡´

#### ğŸ”´ åˆ é™¤é…ç½®ï¼ˆReact è‡ªç„¶å¸è½½ï¼‰
- **é€‚ç”¨èŒƒå›´**: æ‰€æœ‰æŒ‡æ ‡
- **æ“ä½œ**: è®¾ç½® `isDelete: true`ï¼Œè®© React è‡ªç„¶å¸è½½ç»„ä»¶
- **ç»“æœ**: React ç»„ä»¶è¢«å¸è½½ï¼Œlightweight-charts-react-components è‡ªåŠ¨æ¸…ç† Pane
- **æ¨è**: è¿™æ˜¯æ¨èçš„åˆ é™¤æ–¹å¼

#### âš« åŒæ—¶åˆ é™¤ï¼ˆå…ˆåˆ  Pane å†åˆ é…ç½®ï¼‰
- **é€‚ç”¨èŒƒå›´**: å­å›¾æŒ‡æ ‡
- **æ“ä½œ**: å…ˆåˆ é™¤ Paneï¼Œå»¶è¿Ÿ 100ms ååˆ é™¤é…ç½®
- **ç»“æœ**: å¯èƒ½å¯¼è‡´å„ç§é—®é¢˜ï¼Œä¸æ¨èä½¿ç”¨

### 3. è°ƒè¯•åŠŸèƒ½
- å®æ—¶æ˜¾ç¤ºå›¾è¡¨çŠ¶æ€ï¼ˆä¸»å›¾æŒ‡æ ‡æ•°é‡ã€å­å›¾æŒ‡æ ‡æ•°é‡ã€Pane æ•°é‡ç­‰ï¼‰
- æ‰“å°è¯¦ç»†è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
- æ”¯æŒæ·»åŠ æ–°çš„æµ‹è¯•æŒ‡æ ‡
- æ”¯æŒæ¢å¤å·²åˆ é™¤çš„æŒ‡æ ‡

## ä½¿ç”¨æ–¹æ³•

1. è®¿é—® `http://localhost:5173/test-pane-deletion`
2. è§‚å¯Ÿåˆå§‹çŠ¶æ€ï¼š5ä¸ªæŒ‡æ ‡ï¼ˆ2ä¸ªä¸»å›¾ï¼Œ3ä¸ªå­å›¾ï¼‰
3. å°è¯•ä¸åŒçš„åˆ é™¤æ–¹å¼ï¼š
   - ç‚¹å‡» ğŸŸ  æŒ‰é’®ï¼šåªåˆ é™¤ Pane
   - ç‚¹å‡» ğŸ”´ æŒ‰é’®ï¼šåˆ é™¤é…ç½®
   - ç‚¹å‡» âš« æŒ‰é’®ï¼šåŒæ—¶åˆ é™¤
4. è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºå’Œå›¾è¡¨å˜åŒ–
5. ä½¿ç”¨"æ¢å¤"æŒ‰é’®æ¢å¤å·²åˆ é™¤çš„æŒ‡æ ‡
6. ä½¿ç”¨"æ·»åŠ æµ‹è¯•æŒ‡æ ‡"æ·»åŠ æ–°æŒ‡æ ‡è¿›è¡Œæµ‹è¯•

## æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæ­£å¸¸åˆ é™¤æµç¨‹
1. åˆ é™¤ä¸€ä¸ªå­å›¾æŒ‡æ ‡ï¼ˆä½¿ç”¨ ğŸ”´ åˆ é™¤é…ç½®ï¼‰
2. è§‚å¯Ÿ Pane æ˜¯å¦æ­£ç¡®å‡å°‘
3. è§‚å¯Ÿå…¶ä»–æŒ‡æ ‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

### åœºæ™¯2ï¼šé—®é¢˜å¤ç°
1. åˆ é™¤ä¸€ä¸ªå­å›¾æŒ‡æ ‡ï¼ˆä½¿ç”¨ ğŸŸ  åªåˆ é™¤ Paneï¼‰
2. è§‚å¯Ÿæ˜¯å¦å‡ºç°æ¸²æŸ“é—®é¢˜
3. å°è¯•æ¢å¤æŒ‡æ ‡ï¼Œè§‚å¯Ÿæ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º

### åœºæ™¯3ï¼šæ‰¹é‡æ“ä½œ
1. è¿ç»­åˆ é™¤å¤šä¸ªå­å›¾æŒ‡æ ‡
2. è§‚å¯Ÿ Pane ç´¢å¼•æ˜¯å¦æ­£ç¡®è®¡ç®—
3. è§‚å¯Ÿæ˜¯å¦å‡ºç°ç´¢å¼•é”™ä¹±é—®é¢˜

## æŠ€æœ¯ç»†èŠ‚

### Pane ç´¢å¼•è®¡ç®—
```typescript
// å­å›¾çš„ Pane ç´¢å¼• = ä¸»å›¾(0) + å­å›¾ç´¢å¼• + 1
const paneIndex = subChartIndex + 1;
```

### é…ç½®ç»“æ„
```typescript
interface BacktestChartConfig {
  id: number;
  chartName: string;
  klineChartConfig: KlineChartConfig;
  indicatorChartConfigs: IndicatorChartConfig[];
}
```

### åˆ é™¤é€»è¾‘
```typescript
// æ¨èæ–¹å¼ï¼šè½¯åˆ é™¤
setChartConfig(prev => ({
  ...prev,
  indicatorChartConfigs: prev.indicatorChartConfigs.map(config =>
    config.indicatorKeyStr === indicatorKeyStr
      ? { ...config, isDelete: true }
      : config
  )
}));
```

## é¢„æœŸé—®é¢˜

1. **Pane ç´¢å¼•é”™ä¹±**: åˆ é™¤ä¸­é—´çš„ Pane åï¼Œåç»­ Pane çš„ç´¢å¼•ä¼šå‘ç”Ÿå˜åŒ–
2. **React ç»„ä»¶çŠ¶æ€ä¸ä¸€è‡´**: åªåˆ é™¤ Pane ä½†ä¿ç•™é…ç½®å¯èƒ½å¯¼è‡´æ¸²æŸ“é—®é¢˜
3. **å†…å­˜æ³„æ¼**: ä¸æ­£ç¡®çš„åˆ é™¤æ–¹å¼å¯èƒ½å¯¼è‡´ Series æˆ– Pane æ²¡æœ‰è¢«æ­£ç¡®æ¸…ç†

## è§£å†³æ–¹æ¡ˆ

1. **ç»Ÿä¸€ä½¿ç”¨è½¯åˆ é™¤**: é€šè¿‡è®¾ç½® `isDelete: true` è®© React è‡ªç„¶å¸è½½ç»„ä»¶
2. **é¿å…ç›´æ¥æ“ä½œ Pane**: è®© lightweight-charts-react-components ç®¡ç† Pane ç”Ÿå‘½å‘¨æœŸ
3. **æ­£ç¡®è®¡ç®—ç´¢å¼•**: åœ¨åˆ é™¤æ“ä½œä¸­æ­£ç¡®è®¡ç®— Pane ç´¢å¼•ï¼Œè€ƒè™‘å·²åˆ é™¤çš„æŒ‡æ ‡

## ç›¸å…³æ–‡ä»¶

- `src/pages/test-pane-deletion.tsx` - æµ‹è¯•é¡µé¢ä¸»æ–‡ä»¶
- `src/components/chart/backtest-chart/debug/indicator-debug-panel.tsx` - åŸå§‹è°ƒè¯•é¢æ¿
- `src/store/use-backtest-chart-config-store.ts` - é…ç½®ç®¡ç† Store
- `src/components/chart/backtest-chart/mock-data.ts` - æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ
